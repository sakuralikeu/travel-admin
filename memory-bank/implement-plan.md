# 员工客户管理系统实施计划（完整版）

> 本文档为**可直接交付 AI / 人工开发团队执行的实施级方案**，严格遵循：小步迭代、每步可验证、不包含代码、先基础后完善的原则。

---

## 总体约束说明

- 严格按照 `tech_stack_recommendation.md` 中的技术方案与分层规范执行
- 后端：Spring Boot 3.x + Java 17 + MyBatis-Plus + MySQL，统一响应结果、全局异常处理、逻辑删除与分页能力
- 认证与授权：Spring Security + JWT，基于角色与权限矩阵做接口级访问控制
- 前端：Vue 3 + TypeScript + Vite，采用 Ant Design Vue 或 Element Plus，分层结构参考技术栈文档（pages / components / services / stores / types 等）
- 本实施计划当前不包含报表与高级分析模块，相关需求留待后续迭代补充

---

## 阶段一：项目初始化（基础架构）

### 步骤 1.1：创建前后端项目骨架

**任务：** 初始化前端与后端项目结构

**具体要求：**
1. 创建后端项目（Spring Boot 3.x / Java 17 / MyBatis-Plus / MySQL）
2. 创建前端项目（Vue 3 + TypeScript + Vite，使用 Ant Design Vue 或 Element Plus）
3. 统一项目命名规范
4. 初始化Git仓库
5. 建立README说明

**验证测试：**
1. 后端项目可正常启动
2. 前端项目可正常启动
3. README可被新成员理解
4. Git提交记录正常
5. 项目结构清晰

---

### 步骤 1.2：配置开发环境

**任务：** 统一开发环境和基础配置

**具体要求：**
1. 配置多环境（dev/test/prod）
2. 配置数据库连接
3. 配置日志输出策略
4. 配置统一端口规划

**验证测试：**
1. 启动dev环境成功
2. 日志文件正常生成
3. 数据库连接成功
4. 不同环境配置隔离
5. 配置文件可维护

---

### 步骤 1.3：设计基础目录结构

**任务：** 建立清晰的分层架构

**具体要求：**
1. 后端分层：controller / service / mapper / domain
2. 前端分层：pages / components / services / types
3. 公共模块独立

**验证测试：**
1. 新功能可快速定位目录
2. 无循环依赖
3. 命名语义清晰
4. 新成员可快速理解
5. 架构满足扩展需求

---

## 阶段二：员工管理（后端）

### 步骤 2.1：设计员工数据模型

**任务：** 定义员工核心数据结构

**具体要求：**
1. 包含账号、姓名、角色、状态
2. 支持逻辑删除
3. 支持创建/更新时间（自动维护）
4. 字段与约束设计清晰，可直接映射为数据库表结构

**推荐字段与约束：**
- 员工ID：主键，自增或雪花ID
- 登录账号：唯一，必填（支持英文/数字，下划线）
- 姓名：必填，长度 2-50
- 手机号：唯一，必填，11位大陆手机号格式
- 邮箱：可选，需通过邮箱格式校验
- 部门、岗位：可选，支持后续扩展为独立字典表
- 角色：枚举（管理员 / 经理 / 主管 / 员工）
- 状态：枚举（在职 / 离职 / 停用）
- 入职时间、离职时间：可选字段
- 密码：使用 BCrypt 等算法加密存储，不以明文形式落库
- 创建人 / 更新人、创建时间 / 更新时间、逻辑删除标记（deleted）

**验证测试：**
1. 表结构符合业务
2. 字段含义清晰
3. 唯一约束生效
4. 可支持扩展字段
5. 时间字段自动维护

---

### 步骤 2.2：实现员工CRUD接口

**任务：** 实现员工基础管理能力

**具体要求：**
1. 新增员工
2. 编辑员工
3. 查询员工
4. 删除员工（逻辑删除）

**验证测试：**
1. 新增成功
2. 编辑后数据正确
3. 删除后不可见
4. 查询分页正常
5. 异常提示清晰

---

## 阶段三：员工管理（前端）

### 步骤 3.1：创建员工列表页面

**任务：** 实现员工管理UI

**具体要求：**
1. 表格展示员工信息
2. 支持分页
3. 支持搜索
4. 支持新增/编辑

**验证测试：**
1. 页面加载成功
2. 数据展示正确
3. 操作流畅
4. 空数据有提示
5. 无前端报错

---

## 阶段四：认证与授权

### 步骤 4.1：实现登录认证

**任务：** 构建安全认证机制（含前端登录界面与后端认证接口）

**具体要求：**
1. 前端登录页面
   - 统一登录入口：访问未登录的受保护页面时自动跳转到登录页
   - 登录方式采用多标签设计，至少包含：
     - 账号密码登录（当前阶段实现）
     - 验证码登录（预留UI与交互占位，后续阶段实现）
     - 第三方登录（预留入口按钮，后续接入企业微信/飞书等）
   - 账号密码登录表单字段：账号、密码、记住我（可选）
   - 校验规则：账号/密码必填，长度与格式基础校验
   - 交互体验：支持回车提交、提交中按钮loading、防重复点击
   - 错误提示：统一提示“账号或密码错误”，不暴露具体原因
   - 响应式布局：适配常见PC分辨率，移动端基本可用
   - 登录后支持根据地址栏 `redirect` 参数回跳到最初访问的受保护页面
2. 后端登录接口
   - 基于 Spring Security + JWT 实现用户名密码登录
   - 校验账号状态（在职/停用/离职）与密码是否正确
   - 登录成功返回JWT令牌与基础用户信息（ID、姓名、角色等）
   - 登录失败返回规范化错误码与错误文案
3. 登录态保持
   - 前端将令牌安全存储（如localStorage或Cookie，结合HTTPS）
   - 提供“记住我”能力：适度延长令牌有效期，过期后需重新登录
   - 页面刷新后自动从本地恢复登录态并拉取用户信息
4. 会话与安全控制
   - 所有需登录接口统一基于JWT做鉴权，未登录/令牌失效时返回统一错误码
   - 多次登录失败后可扩展图形验证码/短暂锁定机制（预留扩展点）
   - 退出登录接口：后端支持令牌失效（可选），前端清理本地令牌并跳转登录页

**验证测试：**
1. 正确账号可正常登录并跳转到系统首页
2. 错误账号或密码被拦截并展示错误提示
3. 刷新页面后仍保持登录态（在令牌有效期内）
4. 退出登录后访问受保护页面会被重定向到登录页
5. 访问无权限接口被拒绝且提示清晰（与4.2配合验证）

---

### 步骤 4.2：实现角色权限控制

**任务：** 控制不同角色的访问能力

**具体要求：**
1. 角色体系：超级管理员 / 经理 / 主管 / 普通员工，能力参考权限矩阵
2. 超级管理员：系统配置、员工管理、查看和管理全部数据
3. 经理：查看全部员工与客户数据，可审批高级操作（如大额订单、VIP删除）
4. 主管：查看本部门客户，可审批普通操作（如公海领取超限、客户转移）
5. 普通员工：仅管理本人客户，无系统配置权限
6. 接口级权限校验：基于 Spring Security + JWT，在控制器或方法级进行权限注解/配置
7. 前端菜单与按钮权限控制：根据角色动态生成菜单和操作按钮显隐
8. 关键权限点明确：客户删除、VIP删除、客户分配/转移、数据导出、审批操作等需显式受控

**验证测试：**
1. 越权访问被拒绝
2. 菜单按角色展示
3. API直调受限
4. 权限配置清晰
5. 错误提示明确

---

## 阶段五：客户管理

### 步骤 5.1：设计客户数据模型

**任务：** 定义客户核心数据

**具体要求：**
1. 客户基本信息
2. 客户等级（VIP/普通）
3. 分配员工字段
4. 状态字段

**推荐字段与约束：**
- 客户ID：主键
- 姓名：必填
- 手机号：必填且唯一，11位大陆手机号格式
- 微信、邮箱：选填，需格式校验
- 旅游偏好：目的地、预算范围、出行时间偏好等字段
- 客户等级（customer_level）：枚举（VIP、NORMAL）
- 客户状态（customer_status）：枚举
  - NEW：新建未跟进
  - FOLLOWING：跟进中
  - DEAL：已成单
  - LOST：已流失
  - PUBLIC_POOL：公海客户
- 分配员工（assigned_to）：关联员工ID，可为空（为空时视为公海客户）
- 客户来源（渠道）、客户标签、备注等扩展字段
- 创建人 / 更新人、创建时间 / 更新时间、逻辑删除标记（deleted）

**验证测试：**
1. 表结构合理
2. 手机号唯一
3. 可支持后续流转
4. 数据可扩展
5. 与员工表关联正确

---

### 步骤 5.2：实现客户CRUD

**任务：** 实现客户基础管理

**具体要求：**
1. 新增客户
2. 编辑客户
3. 删除客户
4. 分页查询

**验证测试：**
1. 正常创建
2. 重复校验生效
3. 分页准确
4. 数据一致
5. 错误提示明确

---

## 阶段六：客户流转

### 步骤 6.1：实现客户分配

**任务：** 支持客户在员工间流转

**具体要求：**
1. 支持手动分配客户给指定员工
2. 记录完整流转历史（原员工、新员工、时间、原因、操作者）
3. 权限校验：普通员工只能发起客户转移申请，主管及以上角色可审批并执行
4. 客户转移审批：跨员工或跨部门客户转移需走审批流程（规则复用 7.2）
5. 支持按员工、客户维度查看历史流转轨迹

**验证测试：**
1. 分配成功
2. 历史可追溯
3. 越权被阻止
4. 数据一致
5. 多人操作不冲突

---

### 步骤 6.2：实现客户公海池

**任务：** 管理未分配客户

**具体要求：**
1. 公海客户列表：展示进入公海时间、原因、最近一次跟进时间
2. 自动回收规则：普通客户超过30天无跟进记录自动回收至公海
3. 领取限制：默认每名员工每天最多领取20个公海客户，超限需主管审批
4. VIP保护规则：VIP客户不自动进入公海，如需转入必须经理审批；在公海中的VIP仅允许主管及以上角色领取
5. 员工离职客户处理：支持将其名下客户批量转移给指定员工或转入公海，并记录操作日志

**验证测试：**
1. 客户进入公海
2. 领取成功
3. 限额生效
4. VIP限制生效
5. 并发安全

---

## 阶段七：防私单监控

### 步骤 7.1：操作日志记录

**任务：** 全量审计关键操作

**具体要求：**
1. 自动记录增删改查
2. 记录操作者/IP/时间
3. 支持查询

**验证测试：**
1. 所有操作有日志
2. 日志信息完整
3. 查询性能可接受
4. 日志不可篡改
5. 数据可追溯

---

### 步骤 7.2：敏感操作审批

**任务：** 控制高风险操作

**具体要求：**
1. 删除VIP需审批
2. 导出数据需审批
3. 审批记录留痕
4. 客户转移审批：支持按客户或批量发起，跨部门转移需更高权限审批

**验证测试：**
1. 提交审批成功
2. 审批通过后执行
3. 拒绝不执行
4. 审批记录完整
5. 客户转移经审批后正确完成，未通过审批的转移不会生效

---

### 步骤 7.3：异常交易预警

**任务：** 监控订单金额与收款异常，辅助识别私单风险

**具体要求：**
1. 监控订单金额与标准报价或历史均价的偏差，低价/高价超过阈值（如±30%）时产生预警
2. 监控非公司账户收款或标记为线下收款的订单
3. 监控长期未收款订单（如创建超过7天仍未收款）
4. 监控频繁修改订单金额、频繁作废或取消订单等异常行为
5. 预警按等级分类（提醒 / 警告 / 严重），推送给相关员工、主管和管理员

**验证测试：**
1. 通过造数验证低价/高价订单触发对应等级预警
2. 非公司账户或线下收款订单被正确标记并出现在预警列表
3. 超期未收款订单产生预警记录
4. 预警记录可按时间、员工、客户筛选查询
5. 预警关闭后不再重复推送或按设定频率推送
5. 权限控制正确

---

## 阶段八：数据安全

### 步骤 8.1：自动备份

**任务：** 防止数据丢失

**具体要求：**
1. 每日自动执行数据库全量备份，运行在业务低峰期
2. 保留周期可配置（默认30天），到期备份自动清理
3. 失败告警：备份失败触发告警（建议企业微信机器人 + 邮件）
4. 备份文件及元数据（时间、大小、校验结果）有清单记录
5. 备份方案不影响业务响应时间

**验证测试：**
1. 备份文件生成
2. 可恢复使用
3. 过期清理
4. 异常有记录
5. 不影响业务

---

### 步骤 8.2：数据恢复

**任务：** 支持灾难恢复

**具体要求：**
1. 基于备份文件提供全库恢复脚本和操作流程说明
2. 提供单表恢复操作指引（通过恢复至临时库 + SQL导出方式实现），当前不要求开发独立界面或一键工具
3. 所有恢复操作需二次确认，并记录完整操作日志与审批信息

**验证测试：**
1. 恢复成功
2. 数据一致
3. 权限限制生效
4. 有操作日志
5. 风险提示清晰

---

## 阶段九：系统优化

### 步骤 9.1：性能优化

**任务：** 提升系统响应能力

**具体要求：**
1. 缓存热点数据
2. 优化慢查询
3. 限流高频接口

**验证测试：**
1. 响应时间降低
2. 并发稳定
3. 缓存命中率合理
4. 无功能回退
5. 系统稳定

---

### 步骤 9.2：监控与告警

**任务：** 提前发现系统问题

**具体要求：**
1. 健康检查：基于 Spring Boot Actuator 暴露健康与基础指标端点，并接入基础监控系统
2. 错误监控：统一异常日志输出，关键接口记录慢请求与错误明细，支持按 traceId 追踪
3. 异常告警：对服务不可用、错误率或响应时间异常进行告警，至少通过一种渠道（推荐企业微信机器人 + 邮件），告警规则可配置

**验证测试：**
1. 健康状态准确
2. 错误可追踪
3. 告警及时
4. 日志完整
5. 运维可用

---

## 阶段十：测试与部署

### 步骤 10.1：系统测试

**任务：** 确保系统可上线

**具体要求：**
1. 功能测试：覆盖员工管理、客户管理、客户流转、防私单监控、数据安全等核心业务流程
2. 性能测试：在不低于50并发用户场景下，关键接口95%的响应时间 < 2 秒
3. 安全测试：覆盖认证与授权、SQL注入、XSS、CSRF、越权访问等常见安全风险

**验证测试：**
1. 所有功能通过
2. 性能达标
3. 无高危漏洞
4. 数据正确
5. 用户体验良好

---

### 步骤 10.2：生产部署

**任务：** 正式上线系统

**具体要求：**
1. 环境配置
2. Docker部署
3. 反向代理

**验证测试：**
1. 服务正常运行
2. 访问稳定
3. 日志正常
4. 备份生效
5. 监控在线

---

## 附录：总体验收标准

- 功能完整
- 性能达标
- 安全合规
- 数据可追溯
- 运维可持续

---

**本实施计划适用于：中大型企业员工客户管理、防私单、合规审计类系统。**
