# 员工客户管理系统设计文档

## 1. 项目概述

### 1.1 项目背景
本系统为一家中型旅行社开发，旨在提升管理效率，规范业务流程，支持10-15人的团队协作。

### 1.2 项目目标
- 提升管理效率
- 规范业务流程
- 开发专业化的员工与客户管理系统
- 支持年接待客户数达数万人次的业务规模

### 1.3 用户规模
- 内部员工：10-15人
- 客户数量：数万人次/年

## 2. 系统功能模块

### 2.1 员工管理模块

#### 2.1.1 员工信息管理
**功能描述：** 完善的员工档案管理系统

**核心功能：**
- 基础信息维护（姓名、性别、出生日期、联系方式）
- 岗位职责管理（职位、部门、入职时间）
- 权限设置（系统角色、操作权限）
- 员工状态管理（在职、离职、休假）

**数据字段：**
```
- 员工ID（唯一标识）
- 基础信息（姓名、联系方式、身份证号）
- 岗位信息（职位、部门、权限级别）
- 账户信息（登录账号、密码、角色）
```

#### 2.1.2 绩效考核模块
**功能描述：** 员工业绩与服务质量评估

**核心功能：**
- 服务记录跟踪（接待客户数、成交订单数）
- 客户满意度统计
- 月度/季度绩效报表
- 绩效排名展示

**评估维度：**
- 订单成交量
- 客户满意度评分
- 服务响应速度
- 客户投诉率

#### 2.1.3 日志管理
**功能描述：** 操作记录追溯系统

**核心功能：**
- 登录日志记录
- 业务操作日志（客户新增、修改、删除）
- 数据修改历史追踪
- 异常操作预警

### 2.2 客户管理模块

#### 2.2.1 客户信息管理
**功能描述：** 客户档案集中存储

**核心功能：**
- 联系方式管理（电话、微信、邮箱）
- 旅游偏好记录（目的地偏好、预算范围）
- 历史订单查询
- 客户标签分类（VIP、潜在客户、老客户）

**数据字段：**
```
- 客户ID（唯一标识）
- 基本信息（姓名、性别、年龄、联系方式）
- 偏好信息（旅游类型、预算、出行时间偏好）
- 历史记录（订单历史、消费金额、服务评价）
- 客户来源（渠道标记）
```

#### 2.2.2 分级管理
**功能描述：** VIP与普通客户分类管理

**客户等级：**
- **VIP客户**
  - 年消费超过设定阈值
  - 专属客服对接
  - 优先服务权
  - 专享优惠
  
- **普通客户**
  - 标准服务流程
  - 公共客服池分配

**升级规则：**
- 消费金额达标自动升级
- 手动调整客户等级
- 降级规则（长期未消费）

#### 2.2.3 资源分配与流转机制
**功能描述：** 客户资源合理分配系统

**分配规则：**
- 新客户自动分配（轮询、负载均衡）
- 老客户绑定原服务人员
- VIP客户指定专员
- 公海客户池管理

**流转机制：**
- 员工离职客户转移
- 长期未跟进客户回收至公海
- 跨员工协作客户共享
- 客户转移审批流程

### 2.3 防私单管理控制

#### 2.3.1 业务流程线上化
**核心措施：**
- 所有订单必须通过系统录入
- 客户沟通记录系统留痕
- 报价单系统生成与审批
- 收款必须通过公司账户

**流程节点：**
```
客户咨询 → 需求录入 → 方案报价 → 审批 → 合同签订 → 收款 → 服务执行 → 结算
```

#### 2.3.2 交易资金流向监控
**监控维度：**
- 收款账户必须为公司账户
- 订单金额与实际收款对比
- 异常金额预警（超低价、超高价）
- 收款周期监控

**预警规则：**
- 线下收款提醒
- 长时间未收款订单预警
- 价格异常订单标记
- 频繁修改订单金额预警

#### 2.3.3 敏感操作审批验证
**需要审批的操作：**
- 大额订单创建（超过设定金额）
- 特殊折扣申请
- 客户信息导出
- 订单删除/作废
- 退款操作

**审批流程：**
- 操作员发起申请
- 主管/经理审批
- 审批记录留存
- 拒绝原因记录

#### 2.3.4 异常行为预警机制
**监控指标：**
- 员工服务客户数量异常下降
- 成交率异常波动
- 客户流失率突增
- 客户联系方式批量导出
- 非工作时间大量操作

**预警机制：**
- 实时预警通知管理员
- 预警等级分类（提醒、警告、严重）
- 自动生成预警报告
- 预警处理跟踪

### 2.5 登录与认证模块

#### 2.5.1 登录界面设计
**功能描述：** 为内部员工提供统一的系统入口

**界面元素：**
- 系统名称与LOGO展示
- 登录区域采用卡片+多标签页形式，区分多种登录方式
- 账号密码登录表单
  - 账号输入框（手机号/登录账号均可）
  - 密码输入框（支持显示/隐藏切换）
  - 记住我勾选项（本机保存登录态，有限期）
  - 登录按钮
  - 忘记密码入口（指向密码重置流程或管理员联系方式）
- 验证码登录入口（预留）
  - 手机号输入框
  - 获取短信验证码按钮（带倒计时与防刷限制）
  - 验证码输入框
  - 登录按钮
- 第三方登录入口（预留）
  - 企业微信/飞书/钉钉等 SSO 登录按钮
- 底部区域
  - 公司名称与版权信息
  - 安全提示（请勿在公共设备勾选记住我）

**交互要求：**
- 输入框实时校验（必填项为空时提示）
- 登录中状态展示（按钮loading、防重复点击）
- 错误提示友好且不暴露安全细节（如“账号或密码错误”）
- 支持回车键提交
- 支持通过地址栏参数 `redirect` 完成登录后回跳到原访问页面
- 移动端自适应显示

**安全要求：**
- 全程HTTPS访问
- 密码仅在前端做基础校验，不在前端持久化
- 多次登录失败触发账号短暂锁定或图形验证码
- 记住我仅保存加密后的令牌，不保存明文密码

#### 2.5.2 登录业务流程
**流程描述：**
- 员工访问系统域名，进入登录界面
- 默认使用账号密码登录：
  - 输入账号和密码，点击登录
  - 前端对必填项进行校验，通过后调用后端登录接口
  - 后端校验账号状态（在职/停用/离职）和密码正确性
  - 校验通过后生成JWT令牌并返回前端
  - 前端保存令牌（本地存储或Cookie），并拉取当前用户信息与权限
  - 根据角色与权限生成左侧菜单与可见功能
- 预留验证码登录流程（当前阶段仅设计，不实现）：
  - 员工输入手机号，点击获取验证码
  - 系统向绑定手机号发送一次性验证码，并限制发送频率
  - 员工输入收到的验证码，前端调用验证码登录接口
  - 后端校验手机号与验证码匹配关系，通过后生成JWT并完成登录
- 预留第三方登录流程（当前阶段仅设计，不实现）：
  - 员工点击“企业微信/飞书登录”按钮
  - 跳转至第三方授权页面，完成扫码或授权
  - 第三方回调本系统，后端根据回调信息创建或绑定员工账号
  - 后端生成JWT并完成登录

**异常场景处理：**
- 账号或密码错误：提示统一文案，不区分具体原因
- 账号被停用或已离职：提示联系管理员
- 多次失败：提示稍后再试或要求额外验证
- 令牌过期：自动跳转登录页，并提示“登录已过期，请重新登录”

#### 2.5.3 会话与退出机制
**会话管理：**
- JWT中包含员工ID、角色、关键权限信息
- 前端在每次接口调用时携带令牌
- 后端对令牌有效性与权限进行校验

**退出登录：**
- 顶部导航提供“退出登录”入口
- 点击退出后清除本地令牌与用户信息
- 跳转回登录页

**超时控制：**
- 长时间无操作自动失效（超时时长可配置）
- 超时后访问任何受保护页面自动重定向至登录界面

### 2.4 数据安全保障

#### 2.4.1 客户信息删除权限分级管控
**权限分级：**
- **普通员工：** 仅可查看、编辑分配给自己的客户
- **主管：** 可查看部门客户，可删除普通客户
- **经理/管理员：** 可删除VIP客户，需二次验证

**删除规则：**
- 软删除机制（数据标记删除，不实际删除）
- 删除前二次确认
- 删除原因必填
- 删除记录永久保存

#### 2.4.2 数据修改审批留痕
**留痕内容：**
- 修改人员信息
- 修改时间
- 修改前数据
- 修改后数据
- 修改原因

**审批场景：**
- 关键字段修改（客户等级、分配员工）
- 批量数据修改
- 历史订单修改

#### 2.4.3 定期自动备份机制
**备份策略：**
- **增量备份：** 每日凌晨自动备份
- **全量备份：** 每周日进行完整备份
- **异地备份：** 云端存储备份文件
- **保留周期：** 至少保留3个月备份

**备份内容：**
- 数据库完整备份
- 附件文件备份
- 系统配置备份
- 日志文件备份

**恢复机制：**
- 支持任意时间点恢复
- 备份文件完整性校验
- 恢复演练定期进行

## 3. 技术架构设计

### 3.1 系统架构
采用前后端分离架构：
- 前端：Web应用（可响应式支持移动端）
- 后端：RESTful API
- 数据库：关系型数据库
- 部署：云服务器部署

### 3.2 核心技术模块
- 用户认证与授权
- 权限管理系统
- 数据加密存储
- 日志审计系统
- 备份恢复系统

### 3.3 安全性设计
- HTTPS加密传输
- 敏感数据加密存储
- SQL注入防护
- XSS攻击防护
- CSRF令牌验证
- 密码强度要求
- 登录失败锁定机制

## 4. 数据库设计要点

### 4.1 核心数据表
- 员工表（employees）
- 客户表（customers）
- 订单表（orders）
- 操作日志表（operation_logs）
- 权限表（permissions）
- 角色表（roles）
- 备份记录表（backup_records）

### 4.2 关键字段设计
- 所有表包含：created_at, updated_at, deleted_at（软删除）
- 所有表包含：created_by, updated_by（操作人追溯）
- 客户表包含：customer_level（客户等级）、assigned_to（分配员工）
- 订单表包含：approval_status（审批状态）、payment_account（收款账户）

## 5. 业务流程设计

### 5.1 客户分配流程
```
新客户进入 → 系统自动分配/手动分配 → 员工接收 → 首次联系 → 需求记录
```

### 5.2 订单处理流程
```
客户咨询 → 需求录入 → 方案制定 → 报价审批 → 合同签订 → 收款确认 → 服务执行 → 服务完成 → 客户评价
```

### 5.3 客户流转流程
```
客户长期未跟进 → 系统预警 → 主管审核 → 回收至公海 → 重新分配
```

## 6. 权限角色设计

### 6.1 角色定义
- **超级管理员：** 所有权限
- **经理：** 查看所有数据，审批高级操作
- **主管：** 查看部门数据，审批普通操作
- **普通员工：** 查看个人客户，基本操作权限

### 6.2 权限矩阵
| 功能 | 普通员工 | 主管 | 经理 | 管理员 |
|------|---------|------|------|--------|
| 查看个人客户 | ✓ | ✓ | ✓ | ✓ |
| 查看部门客户 | ✗ | ✓ | ✓ | ✓ |
| 查看全部客户 | ✗ | ✗ | ✓ | ✓ |
| 删除客户 | ✗ | ✓ | ✓ | ✓ |
| 删除VIP客户 | ✗ | ✗ | ✓ | ✓ |
| 订单审批 | ✗ | ✓ | ✓ | ✓ |
| 数据导出 | ✗ | ✗ | ✓ | ✓ |
| 员工管理 | ✗ | ✗ | ✓ | ✓ |
| 系统配置 | ✗ | ✗ | ✗ | ✓ |

## 7. 报表统计需求

### 7.1 员工绩效报表
- 月度接待客户数
- 月度成交订单数
- 月度成交金额
- 客户满意度平均分
- 员工排名

### 7.2 客户分析报表
- 客户来源分析
- 客户等级分布
- 客户流失率分析
- 复购率统计
- 客户生命周期价值

### 7.3 业务数据报表
- 日/周/月订单统计
- 收入趋势分析
- 产品销售排行
- 区域业务分布

### 7.4 异常监控报表
- 异常操作汇总
- 预警事件统计
- 审批通过率
- 系统使用情况

## 8. 非功能性需求

### 8.1 性能要求
- 系统响应时间 < 2秒
- 并发用户支持 > 50人
- 数据查询响应 < 1秒
- 支持万级客户数据

### 8.2 可用性要求
- 系统可用性 > 99%
- 定期维护窗口通知
- 故障恢复时间 < 4小时

### 8.3 易用性要求
- 简洁直观的操作界面
- 关键操作引导提示
- 移动端适配支持
- 操作培训文档

## 9. 实施计划建议

### 9.1 第一阶段（核心功能）
- 用户认证与权限系统
- 员工管理模块
- 客户管理基础功能
- 订单管理基础功能

### 9.2 第二阶段（增强功能）
- 客户分配流转机制
- 防私单监控系统
- 数据审计日志
- 基础报表统计

### 9.3 第三阶段（完善优化）
- 高级报表分析
- 数据备份恢复
- 性能优化
- 移动端支持

## 10. 运维保障

### 10.1 日常运维
- 每日备份检查
- 系统日志审查
- 性能监控
- 安全漏洞扫描

### 10.2 应急预案
- 数据丢失恢复流程
- 系统故障应急方案
- 安全事件响应流程
- 业务连续性计划
